# MLOps & MLflow å®è·µæŒ‡å— ğŸš€

![MLOps Lifecycle](docs/images/mlops-lifecycle.png) <!-- è¯·æ›¿æ¢ä¸ºå®é™…å›¾ç‰‡ -->
![MLflow Architecture](docs/images/mlflow-arch.png) <!-- è¯·æ›¿æ¢ä¸ºå®é™…å›¾ç‰‡ -->
![YOLO Integration](docs/images/yolo-integration.png) <!-- è¯·æ›¿æ¢ä¸ºå®é™…å›¾ç‰‡ -->

[![MLflow](https://img.shields.io/badge/MLflow-0194E2?style=flat&logo=mlflow&logoColor=white)](https://mlflow.org/)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ğŸ“– ç›®å½•
- [MLOps æˆç†Ÿåº¦æ¨¡å‹](#-mlops-æˆç†Ÿåº¦æ¨¡å‹)
- [âœ¨ MLflow æ ¸å¿ƒåŠŸèƒ½](#-mlflow-æ ¸å¿ƒåŠŸèƒ½)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ğŸ”§ åŠŸèƒ½è¯¦è§£](#-åŠŸèƒ½è¯¦è§£)
- [ğŸ¤ è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

## ğŸŒŸ MLOps æˆç†Ÿåº¦æ¨¡å‹

| ç­‰çº§ | æ ¸å¿ƒèƒ½åŠ› | è¿­ä»£é€Ÿåº¦ | å…³é”®ç»„ä»¶ |
|------|----------|----------|----------|
| **0ï¸âƒ£ æ‰‹åŠ¨é˜¶æ®µ** | å…¨æ‰‹åŠ¨æµç¨‹ | <5æ¬¡/å¹´ | æ— è‡ªåŠ¨åŒ–ä½“ç³» |
| **1ï¸âƒ£ è‡ªåŠ¨åŒ–CT** | æŒç»­è®­ç»ƒ | å‘¨çº§è¿­ä»£ | ç‰¹å¾åº“/å…ƒæ•°æ®ç®¡ç† |
| **2ï¸âƒ£ CI/CDè‡ªåŠ¨åŒ–** | åˆ†é’Ÿçº§éƒ¨ç½² | æŒ‰éœ€å‘å¸ƒ | æ¨¡å‹æ³¨å†Œä¸­å¿ƒ/å…¨é“¾è·¯ç›‘æ§ |

## âœ¨ MLflow æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ å®éªŒè¿½è¸ªï¼ˆTrackingï¼‰
import mlflow
with mlflow.start_run():
mlflow.log_param("learning_rate", 0.01) # è®°å½•è¶…å‚æ•°
mlflow.log_metric("accuracy", 0.92) # è·Ÿè¸ªæŒ‡æ ‡
mlflow.log_artifact("model.pkl") # ä¿å­˜äº§å‡ºç‰©

### ğŸ“¦ é¡¹ç›®æ‰“åŒ…ï¼ˆProjectsï¼‰

MLproject
name: æˆ¿ä»·é¢„æµ‹
conda_env: conda.yaml
entry_points:
main:
parameters:
data_file: path
command: "python train.py {data_file}"

### ğŸ§© æ¨¡å‹ç®¡ç†ï¼ˆModelsï¼‰
mlflow.pyfunc.log_model(
"model",
python_model=SklearnModelWrapper(model),
conda_env=conda_env,
registered_model_name="æˆ¿ä»·é¢„æµ‹æ¨¡å‹"
)

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. å®‰è£…ä¾èµ–
pip install mlflow ultralytics
2. å¯åŠ¨MLflowæœåŠ¡
mlflow server --backend-store-uri runs/mlflow --host 0.0.0.0 --port 5000
3. è¿è¡ŒYOLOå®éªŒ
from ultralytics import YOLO
model = YOLO('yolov8n.pt')
results = model.train(data='coco128.yaml', epochs=100)

## ğŸ”§ åŠŸèƒ½è¯¦è§£

### å®éªŒå¯¹æ¯”åˆ†æ
- å¤šç»´åº¦æŒ‡æ ‡å¯¹æ¯”ï¼ˆå‡†ç¡®ç‡ã€F1å€¼ã€è®­ç»ƒæ—¶é•¿ï¼‰
- è¶…å‚æ•°ç»„åˆç­›é€‰
- å®éªŒç‰ˆæœ¬å·®å¼‚å¯¹æ¯”

### æ¨¡å‹éƒ¨ç½²æµç¨‹
1. æ¨¡å‹éªŒè¯ â†’ 2. æ‰“åŒ…å®¹å™¨ â†’ 3. A/Bæµ‹è¯• â†’ 4. ç”Ÿäº§å‘å¸ƒ

## ğŸ¤ è´¡çŒ®æŒ‡å—
æ¬¢è¿é€šè¿‡ Issue æäº¤å»ºè®®æˆ– PR è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªï¼š
1. ä¿æŒä»£ç é£æ ¼ç»Ÿä¸€
2. æ·»åŠ å¿…è¦çš„å•å…ƒæµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£

[ğŸ“š æŸ¥çœ‹å®Œæ•´æ–‡æ¡£](https://mlflow.org/docs/latest/index.html) | [ğŸ› æäº¤é—®é¢˜](https://github.com/mlflow/mlflow/issues)

#  ç”¨æ³•ç¤ºä¾‹ï¼š
# å·¥ä¸šå‚æ•°æ‹Ÿåˆä¸é¢„æµ‹æ¨¡å‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäºçº¿æ€§å›å½’å’Œæœ€å°äºŒä¹˜æ³•çš„å·¥ä¸šå‚æ•°é¢„æµ‹æ¨¡å‹ï¼Œé›†æˆMLflowè¿›è¡Œå®éªŒè·Ÿè¸ªå’Œæ¨¡å‹ç®¡ç†ã€‚

## ä¸»è¦åŠŸèƒ½
- å¤šç»´åº¦å·¥ä¸šå‚æ•°æ‹Ÿåˆåˆ†æ
- çº¿æ€§å›å½’æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°
- æœ€å°äºŒä¹˜æ³•å‚æ•°ä¼˜åŒ–
- MLflowå®éªŒè·Ÿè¸ªç®¡ç†
- å¯è§†åŒ–ç»“æœè¾“å‡º

## ä¾èµ–ç¯å¢ƒ
- Python 3.8+
- ä¸»è¦ä¾èµ–åº“ï¼š
  ```bash
  pip install numpy scikit-learn matplotlib mlflow scipy
  ```

## å¿«é€Ÿå¼€å§‹
1. å…‹éš†ä»“åº“
   ```bash
   git clone https://github.com/yourusername/industrial-parameter-fitting.git
   cd industrial-parameter-fitting
   ```

2. è¿è¡Œä¸»ç¨‹åº
   ```bash
   python main.py
   ```

3. æŸ¥çœ‹MLflowç»“æœ
   ```bash
   mlflow ui
   ```
   åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:5000`

## æ•°æ®é…ç½®
ä¿®æ”¹ä»£ç ä¸­çš„åŸå§‹æ•°æ®éƒ¨åˆ†ï¼š

## ç»“æœè¾“å‡º
- è‡ªåŠ¨ä¿å­˜ä¸¤ç§å¯è§†åŒ–ç»“æœï¼š
  -------------------------|---------------------------
  çº¿æ€§å›å½’ç»“æœ            | æœ€å°äºŒä¹˜æ‹Ÿåˆç»“æœ

- MLflowè·Ÿè¸ªè®°å½•ï¼š
  - æ¨¡å‹å‚æ•° (test_size, random_state)
  - è¯„ä¼°æŒ‡æ ‡ (MSE, MAE)
  - è®­ç»ƒæ¨¡å‹æ–‡ä»¶
  - å¯è§†åŒ–å›¾è¡¨



# å·¥ä¸šå›¾åƒåˆ†ç±»è®­ç»ƒç³»ç»Ÿ

åŸºäºYOLOv8å’ŒMLflowçš„æ™ºèƒ½åˆ†ç±»è®­ç»ƒæ¡†æ¶ï¼Œæ”¯æŒå®Œæ•´çš„å®éªŒè·Ÿè¸ªå’Œæ•°æ®åˆ†ææµç¨‹ã€‚

![è®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–](assets/training_visualization.png)  
*MLflowè·Ÿè¸ªç•Œé¢ç¤ºä¾‹*

## æ ¸å¿ƒåŠŸèƒ½

- ğŸ–¼ï¸ è‡ªåŠ¨åŒ–å›¾åƒæ•°æ®é›†åŠ è½½ä¸é¢„å¤„ç†
- ğŸ“Š æ™ºèƒ½æ•°æ®åˆ†å¸ƒåˆ†æä¸å¯è§†åŒ–
- ğŸ§  YOLOv8åˆ†ç±»æ¨¡å‹è®­ç»ƒæ”¯æŒ
- ğŸ” MLflowå®éªŒå…¨æµç¨‹è·Ÿè¸ª
- ğŸ“ è‡ªåŠ¨ç”ŸæˆYOLOæ ¼å¼æ•°æ®é›†é…ç½®
- ğŸ“ˆ è®­ç»ƒæŒ‡æ ‡å®æ—¶ç›‘æ§

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDA 11.7+ (æ¨èGPUç¯å¢ƒ)
- ä¾èµ–å®‰è£…ï¼špip install ultralytics mlflow pandas scikit-learn


## å¿«é€Ÿå¼€å§‹

1. æ•°æ®å‡†å¤‡ï¼ˆæŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼‰ï¼š
dataset/
class_1/
img1.jpg
img2.png
class_2/
img3.webp
...

2. å¯åŠ¨è®­ç»ƒï¼š
python main.py --data_dir ./dataset --imgsz 640 --epochs 100

3. ç›‘æ§è®­ç»ƒè¿‡ç¨‹ï¼š
mlflow ui --port 5000

## æ ¸å¿ƒå‚æ•°é…ç½®

é€šè¿‡`train_model`å‡½æ•°é…ç½®è®­ç»ƒå‚æ•°ï¼š
params = {
"data": yaml_path, # è‡ªåŠ¨ç”Ÿæˆçš„YAMLé…ç½®
"epochs": 100, # è®­ç»ƒæ€»è½®æ¬¡
"imgsz": 320, # è¾“å…¥å›¾åƒå°ºå¯¸
"batch": 32, # æ‰¹æ¬¡å¤§å°
"lr0": 0.02, # åˆå§‹å­¦ä¹ ç‡
"dropout": 0.2, # Dropoutæ¦‚ç‡
"optimizer": "SGD", # ä¼˜åŒ–å™¨é€‰æ‹©
"seed": 20240722 # éšæœºç§å­
}

## æ•°æ®ç®¡ç†ç‰¹æ€§

- è‡ªåŠ¨ç”Ÿæˆæ•°æ®é›†åˆ†ææŠ¥å‘Šï¼š
  - ç±»åˆ«åˆ†å¸ƒç›´æ–¹å›¾
  - è®­ç»ƒ/æµ‹è¯•é›†æ¯”ä¾‹
  - å›¾åƒè·¯å¾„æ˜ å°„è¡¨
- æ™ºèƒ½æ•°æ®åˆ†å‰²ï¼š
  ```python
  X_train, X_test = train_test_split(
      file_paths, 
      test_size=0.2,
      stratify=labels  # ä¿æŒç±»åˆ«åˆ†å¸ƒ
  )
  ```

## MLflowè·Ÿè¸ªé¡¹

| è·Ÿè¸ªç±»å‹       | è®°å½•å†…å®¹                  |
|----------------|-------------------------|
| å‚æ•°           | è¶…å‚æ•°/æ•°æ®é›†è·¯å¾„/æ¨¡å‹é…ç½® |
| æŒ‡æ ‡           | å‡†ç¡®ç‡/Lossæ›²çº¿/mAP      |
| å›¾è¡¨           | æ··æ·†çŸ©é˜µ/PRæ›²çº¿          |
| æ¨¡å‹           | æœ€ä½³æ¨¡å‹å¿«ç…§             |
| æ•°æ®é›†åˆ†æ     | ç±»åˆ«åˆ†å¸ƒ/åˆ†å‰²ç­–ç•¥        |

## é¡¹ç›®ç»“æ„

â”œâ”€â”€ main.py # ä¸»å…¥å£
â”œâ”€â”€ dataset/ # æ•°æ®ç›®å½•ï¼ˆç¤ºä¾‹ï¼‰
â”œâ”€â”€ pts/ # æ¨¡å‹é…ç½®
â”‚ â”œâ”€â”€ yolov8s-cls.yaml # YOLOåˆ†ç±»é…ç½®
â”‚ â””â”€â”€ yolov8s-cls.pt # é¢„è®­ç»ƒæƒé‡
â”œâ”€â”€ data_split.csv # è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åˆ†å‰²
â””â”€â”€ mlruns/ # MLflowè®°å½•ç›®å½•
## è®¸å¯åè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache 2.0 License](LICENSE)ï¼Œå…è®¸å•†ä¸šä½¿ç”¨ä½†éœ€ä¿ç•™ç‰ˆæƒå£°æ˜ã€‚

ä¸»è¦ç‰¹ç‚¹è¯´æ˜ï¼š
1. é‡‡ç”¨æ¨¡å—åŒ–ç»“æ„å±•ç¤ºä¸åŒåŠŸèƒ½ç»„ä»¶
åŒ…å«å¯è§†åŒ–çš„å·¥ä½œæµç¨‹å›¾å’Œç•Œé¢é¢„è§ˆ
çªå‡ºMLflowçš„è·Ÿè¸ªèƒ½åŠ›è®¾è®¡
å¼ºè°ƒå·¥ä¸šçº§åº”ç”¨çš„å¯é æ€§
æä¾›ä»æ•°æ®å‡†å¤‡åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´é“¾è·¯è¯´æ˜
